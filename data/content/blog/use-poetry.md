---
title: poetryä½¿ç”¨æŒ‡å—
publishDate: 2024-11-11
description: å…³äºä½¿ç”¨poetryçš„ä¸€ç‚¹å¿ƒå¾—
---

pythonç”¨æˆ·å¯¹condaè¿™æ¬¾æµè¡Œçš„åŒ…ç®¡ç†å·¥å…·ä¸€å®šä¸ä¼šæ„Ÿåˆ°é™Œç”Ÿã€‚ç„¶è€Œï¼Œä½¿ç”¨æ—¶é—´é•¿äº†ï¼Œå°±ä¼šå¯¹å®ƒæç«¯çš„ç¯å¢ƒç®¡ç†æ–¹æ¡ˆã€è‡ƒè‚¿çš„åŒ…æ„Ÿåˆ°å›°æƒ‘â€”â€”anacondaè¿‡äºè‡ƒè‚¿ï¼Œå®ƒé»˜è®¤ä¸ºç”¨æˆ·å®‰è£…äº†ä¼—å¤šç”¨äºç§‘å­¦è®¡ç®—çš„åŒ…ï¼Œå®‰è£…åå¤§æ¦‚5-6Gã€‚ä½ å¯ä»¥é€‰æ‹©anacondaçš„ç²¾ç®€ç‰ˆï¼šminicondaã€‚å®ƒä¸åŒ…å«é»˜è®¤çš„ç§‘å­¦è®¡ç®—åº“ï¼Œä½†minicondaä»ç„¶å­˜åœ¨å®‰è£…ä»¥æ¥è¿‡äºæ¿€è¿›çš„é—®é¢˜ã€‚å®‰è£…åŒæ ·çš„åŒ…ï¼Œcondaå¯èƒ½ä¼šå®‰è£…æ¯”åˆ«çš„åŒ…ç®¡ç†å·¥å…·æ›´å¤šçš„ä¾èµ–ï¼Œè¿™ä¼šå¯¼è‡´é¡¹ç›®ç¯å¢ƒä¸æ–­è†¨èƒ€ã€‚äºæ˜¯æˆ‘å†³å®šå¼€å§‹ä½¿ç”¨poetryæ¥ç®¡ç†è™šæ‹Ÿç¯å¢ƒã€‚

## poetry æ˜¯ä»€ä¹ˆ

> https://python-poetry.org

Poetry å·®ä¸å¤šæ˜¯ pip + venvï¼Œçš„ç»“åˆä½“ã€‚å¯ä»¥ç±»ä¼¼ pip ç”¨äºç®¡ç†ç¬¬ä¸‰æ–¹æ¨¡å—çš„ç®¡ç†ï¼Œä½†æ˜¯æ¯” pip çš„åŠŸèƒ½å¼ºå¤§è®¸å¤šï¼ŒåŒæ—¶è¿˜åŒ…å« venv çš„è™šæ‹Ÿç¯å¢ƒç®¡ç†åŠŸèƒ½ã€‚å¤§è‡´çš„åŠŸèƒ½å¦‚ä¸‹ï¼š

- ç®¡ç†ç¬¬ä¸‰æ–¹æ¨¡å—çš„å®‰è£…ä¸å¸è½½
- ç®¡ç†è™šæ‹Ÿç¯å¢ƒ
- ç®¡ç†è™šæ‹Ÿç¯å¢ƒçš„ä¾èµ–
- ç®¡ç†æ‰“åŒ…ä¸å‘å¸ƒ

## åè¯è§£é‡Šï¼šè™šæ‹Ÿç¯å¢ƒç®¡ç†ã€æ¨¡å—ç®¡ç†ã€æ¨¡å—ä¾èµ–ç®¡ç†

åœ¨å¼€å§‹ä¹‹å‰ï¼Œå…ˆä»‹ç»ä¸€ä¸‹å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚

### è™šæ‹Ÿç¯å¢ƒ

è™šæ‹Ÿç¯å¢ƒæ˜¯æŒ‡å†…å»ºçš„ venv æˆ– virtualenv ã€ conda ä»¥åŠå…¶ä»–ç”¨æ¥åˆ›å»ºä¸ç®¡ç† Python è™šæ‹Ÿç¯å¢ƒçš„å·¥å…·ï¼Œä¸åŒçš„è™šæ‹Ÿç¯å¢ƒå„è‡ªç‹¬ç«‹ï¼Œå­˜æ”¾çš„ä½ç½®ã€å®‰è£…çš„æ¨¡å—ä¹Ÿéƒ½ä¸ä¸€æ ·ã€‚

### æ¨¡å—ç®¡ç†ã€æ¨¡å—ä¾èµ–ç®¡ç†

æ¨¡å—æ˜¯æŒ‡è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…çš„ç¬¬ä¸‰æ–¹æ¨¡å—åŠå…¶ç‰ˆæœ¬ã€‚å¤§å¤šæ•°é¡¹ç›®å¯¹ç¬¬ä¸‰æ–¹åº“çš„ç‰ˆæœ¬éƒ½æ˜¯æœ‰ç‰¹å®šè¦æ±‚ï¼Œå¦‚æœå¯¹æ—§ç‰ˆæœ¬çš„é¡¹ç›®ä½¿ç”¨æ–°ç‰ˆæœ¬çš„ä¾èµ–ï¼Œå¯èƒ½ä¼šæŠ¥å¾ˆå¥‡æ€ªçš„é”™è¯¯ã€‚

å½“å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—æ—¶ï¼Œç¬¬ä¸‰æ–¹æ¨¡å—å¯èƒ½ä¼šå®‰è£…è‡ªå·±ä¾èµ–çš„æ¨¡å—ã€‚å½“å®‰è£…ä¸¤ä¸ªä»¥ä¸Šæ¨¡å—æ—¶ï¼Œå°±å¯èƒ½å‡ºç°ç¬¬ä¸‰æ–¹æ¨¡å—çš„ä¾èµ–å‡ºç°å†²çªã€‚è¿™ç§æƒ…å†µä¸€èˆ¬æ˜¯ä¾èµ–çš„ç‰ˆæœ¬å†²çªã€‚è¿™ç§å°±å«åšç›¸å…³æ€§ä¾èµ–ã€‚

## pip çš„ä¸è¶³

pip æ˜¯ python å†…ç½®çš„ä¾èµ–ç®¡ç†å·¥å…·ï¼Œè€Œå®ƒæœ€å¤§çš„ä¸è¶³åœ¨äº ç¬¬ä¸‰æ–¹æ¨¡å—çš„ç›¸å…³æ€§ä¾èµ–ç®¡ç† çš„èƒ½åŠ›ä¸è¶³ã€‚å°¤å…¶æ˜¯åœ¨åˆ é™¤ç¬¬ä¸‰æ–¹æ¨¡å—æ˜¯çš„ä¾èµ–è§£æï¼Œ å¯ä»¥è¯´æ˜¯ä¸ä¼šåˆ†æä¾èµ–ã€‚

æˆ‘ä»¬çœ‹ä¸€ä¸ªæ¡ˆä¾‹ï¼š

1ã€åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ


```shell
~/coding> conda create -n myenv python=3.13
(myenv) ~/coding>
```

2ã€å®‰è£… flask å¹¶æŸ¥çœ‹å®‰è£…å¥½çš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼ˆä¾èµ–ï¼‰

```shell
(myenv) ~/coding>pip install flask
(myenv) ~/coding>pip list
Package      Version
------------ -------
blinker      1.6.2
click        8.1.3
colorama     0.4.6
Flask        2.3.2
itsdangerous 2.1.2
Jinja2       3.1.2
MarkupSafe   2.1.2
pip          22.3.1
setuptools   65.5.0
Werkzeug     2.3.6
```

3ã€ç„¶ååˆ é™¤ flask æ¨¡å—

```shell
(myenv) ~/coding>pip uninstall flask
Found existing installation: Flask 2.3.2
Uninstalling Flask-2.3.2:
  Would remove:
    /Users/username/anaconda3/envs/myvenv/lib/python3.13/site-packages/flask-2.3.2.dist-info\*
    /Users/username/anaconda3/envs/myvenv/lib/python3.13/site-package/flask\*
Proceed (Y/n)? y
  Successfully uninstalled Flask-2.3.2

(myvenv) ~/codingo>pip list
Package      Version
------------ -------
blinker      1.6.2[pyproject.toml](..%2F..%2F..%2Fpoetry-demo%2Fpyproject.toml)
click        8.1.3
colorama     0.4.6
itsdangerous 2.1.2
Jinja2       3.1.2
MarkupSafe   2.1.2
pip          22.3.1
setuptools   65.5.0
Werkzeug     2.3.6
```

ç„¶åå°±ä¼šå‘ç°ï¼Œåªå°‘äº† flask æ¨¡å—ï¼Œè€Œå®‰è£… flask æ—¶é¡ºå¸¦å®‰è£…çš„ä¾èµ–å…¨éƒ¨è¢«ç•™ä¸‹äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ pip å®‰è£…æ¨¡å—æ˜¯ï¼Œç›¸å…³çš„ä¾èµ–éƒ½ä¼šè¢«ä¸‹è½½å®‰è£…ã€‚ä½†æ˜¯åœ¨åˆ é™¤æ—¶ï¼Œpip å°±ä¸ä¼šè¿›è¡Œç®¡ç†äº†ï¼Œè€Œæ˜¯ç›´æ¥æŠŠæŒ‡å®šçš„æ¨¡å—ç§»é™¤ï¼Œç•™ä¸‹ä¸€å †ä¾èµ–ã€‚

## ä»é›¶å¼€å§‹ä½¿ç”¨ Poetry

### å®‰è£…

poetry æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå®‰è£…ä¹‹åå°±å¯ä»¥ä½¿ç”¨ poetry æŒ‡ä»¤,å¯ä»¥å°†å…¶å®‰è£…å…¨å±€ç¯å¢ƒæˆ–è€…æ˜¯è™šæ‹Ÿç¯å¢ƒã€‚

```shell
pip install poetry
```

å®‰è£…ä¹‹åå°±ä¼šåœ¨ python è§£é‡Šå™¨çš„å®‰è£…ç›®å½•ä¸‹çš„ Scripts ç›®å½•é‡Œé¢å‡ºç° poetry.exeï¼Œå› ä¸ºåœ¨å®‰è£… python è§£é‡Šå™¨æ˜¯é…ç½®è¿‡ç¯å¢ƒå˜é‡ï¼Œç„¶åå°±å¯ä»¥ç›´æ¥å…¨å±€ä½¿ç”¨äº†ã€‚

### åˆå§‹åŒ– poetry é¡¹ç›®

ä¸ºäº†æ–¹ä¾¿è§£è¯´ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œåç§°ä¸º poetry_test
æŒ‡å®šéƒ½éå¸¸ç®€å•ï¼Œå»ºè®®è·Ÿç€ä¸€æ­¥æ­¥è‡ªå·±ä¹Ÿå°è¯•ä¸€ä¸‹ã€‚

1ã€åˆå§‹åŒ–é¡¹ç›®

```shell
~/coding>mkdir poetry_test
~/coding> cd poetry_test
~/coding/poetry_test> poetry init
```

ç„¶åä¼šè·³å‡ºæ¥ä¸€è¿ä¸²çš„äº’åŠ¨å¯¹è¯ï¼Œç”¨äºåˆ›å»ºé¡¹ç›®çš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘å°±ç›´æ¥å…¨éƒ¨ä¸€è·¯å›è½¦ï¼Œç„¶åçœ‹ä¸€ä¸‹ç”Ÿæˆçš„ pyproject.toml é…ç½®æ–‡ä»¶ï¼š

```shell
[tool.poetry]
name = "poetry-test"
version = "0.1.0"
description = ""
authors = ["Your Name <you@example.com>"]
readme = "README.md"

[tool.poetry.dependencies]
python = "^3.13"


[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"
```

æ­¤æ—¶é¡¹ç›®çš„ç›®å½•æ¥å£å¦‚ä¸‹ï¼š

```shell
poetry_test
â””â”€â”€ pyproject.toml

0 directories, 1 file
```

## ç®¡ç†è™šæ‹Ÿç¯å¢ƒ

poetry é¢„è®¾äº†å¾ˆå¤šè‡ªå·±çš„è™šæ‹Ÿç¯å¢ƒé…ç½®ï¼Œè¿™äº›é…ç½®å¯ä»¥é€šè¿‡ poetry config è¿›è¡Œä¿®æ”¹ã€‚
Macos ç³»ç»Ÿä¸‹ poetry é¢„è®¾æ˜¯å°†è™šæ‹Ÿç¯å¢ƒåˆ›å»ºåœ¨ /Users/<ç”¨æˆ·å>/Library/Caches/pypoetry/virtualenvs ç›®å½•ä¸‹ï¼Œå½“ç”¨æˆ·åœ¨æ‰§è¡Œ poetry add ç­‰æŒ‡ä»¤æ—¶ï¼Œpoetry éƒ½ä¼šè‡ªåŠ¨æ£€æŸ¥å½“ä¸‹æ˜¯å¦æ­£åœ¨ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼š
- å¦‚æœæ˜¯ï¼Œåˆ™ä¼šç›´æ¥å®‰è£…æ¨¡å—åˆ°å½“å‰çš„è™šæ‹Ÿç¯å¢ƒä¸‹
- å¦‚æœå¦ï¼Œåˆ™ä¼šè‡ªåŠ¨å¸®ä½ åˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿç¯å¢ƒï¼Œç„¶åå†å®‰è£…æ¨¡å—

## åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

ä½¿ç”¨æŒ‡ä»¤ poetry env use pythonï¼š

```shell
â”€ ï¼  ~/coding/poetry_test                                                                      ï€Œ   82% ï‰€  21:21 ï€— 11.11 ï³ 
â•°ï‘ ï‘ ï‘  poetry env use python
Creating virtualenv poetry-test-ynfwcHPh-py3.13 in /Users/username/Library/Caches/pypoetry/virtualenvs
Using virtualenv: /Users/username/Library/Caches/pypoetry/virtualenvs/poetry-test-ynfwcHPh-py3.13
```

å¯ä»¥çœ‹å‡º poetry ä¸ºåˆ›å»ºåˆ›å»ºä¸€ä¸ªåä¸º poetry-test-ynfwcHPh-py3.13 çš„è™šæ‹Ÿç¯å¢ƒ

### é‡ç‚¹è¯´æ˜

poetry env use python æ˜¯ä½¿ç”¨å½“å‰å‘½ä»¤è¡Œä¸‹æ¿€æ´»çš„ python è§£é‡Šå™¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
ä¹Ÿå¯ä»¥å°†æŒ‡ä»¤æœ€åçš„ python ï¼Œæ”¹ä¸º python3ã€python3.8ï¼Œä¹‹ç±»çš„ï¼Œç”šè‡³åªè¦éœ€è¦ 3.8ï¼Œåªè¦ç¡®ä¿å¯¹äºçš„è§£é‡Šå™¨èƒ½å¤Ÿåœ¨ç¯å¢ƒå˜é‡ä¸­æ‰¾åˆ°ã€‚
æ›´å¤šçš„é…ç½®å¯ä»¥æŸ¥çœ‹ [å®˜æ–¹æ–‡æ¡£](https://python-poetry.org/docs/managing-environments/)

poetry é»˜è®¤ä¼šå°†è™šæ‹Ÿç¯å¢ƒç»Ÿä¸€æ”¾åœ¨æŒ‡å®šç›®å½•ï¼Œä¾‹å¦‚åˆšåˆšåˆ›å»ºçš„é¡¹ç›®å°±æ”¾åœ¨ /Users/username/Library/Caches/pypoetry/virtualenvs/ ç›®å½•å½“ä¸­ã€‚

è™šæ‹Ÿç¯å¢ƒçš„å‘½åæ¨¡å¼ä¸º é¡¹ç›®å-éšæœºæ•°-pythonç‰ˆæœ¬ã€‚

## åœ¨å½“å‰é¡¹ç›®ä¸‹åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ poetry config --list æŒ‡ä»¤æ¥æŸ¥çœ‹ poetry çš„å‡ ä¸ªä¸»è¦è®¾å®šï¼š

```shell
â•­â”€ ï¼  ~/coding/poetry_test                                                                      ï€Œ   82% ï‰€  21:21 ï€— 11.11 ï³ 
â•°ï‘ ï‘ ï‘  poetry config --list
cache-dir = "/Users/username/Library/Caches/pypoetry"
experimental.system-git-client = false
installer.max-workers = null
installer.modern-installation = true
installer.no-binary = null
installer.parallel = true
keyring.enabled = true
solver.lazy-wheel = true
virtualenvs.create = true
virtualenvs.in-project = null
virtualenvs.options.always-copy = false
virtualenvs.options.no-pip = false
virtualenvs.options.no-setuptools = false
virtualenvs.options.system-site-packages = false
virtualenvs.path = "{cache-dir}/virtualenvs"  # /Users/username/Library/Caches/pypoetry/virtualenvs
virtualenvs.prefer-active-python = false
virtualenvs.prompt = "{project_name}-py{python_version}"
warnings.export = true
```

å…¶ä¸­ virtualenvs.create = true è‹¥æ”¹ä¸º falseï¼Œåˆ™å¯ä»¥åœæ­¢ poetry åœ¨æ£€æŸ¥ä¸åˆ°è™šæ‹Ÿç¯å¢ƒæ˜¯è‡ªåŠ¨åˆ›å»ºçš„è¡Œä¸ºæ¨¡å¼ï¼Œä½†æ˜¯å»ºè®®ä¸è¦æ”¹åŠ¨ã€‚
è€Œ virtualenvs.in-project = false å°±æ˜¯æˆ‘ä»¬è¦ä¿®æ”¹çš„ç›®æ ‡ï¼Œä½¿ç”¨æŒ‡ä»¤ï¼š

```shell
poetry config virtualenvs.in-project true
```

å…ˆæŠŠä¹‹å‰åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒåˆ é™¤

```shell
â•­â”€ ï¼  ~/coding/poetry_test                                                                      ï€Œ   82% ï‰€  21:28 ï€— 11.11 ï³ 
â•°ï‘ ï‘ ï‘  poetry env remove python
Deleted virtualenv: /Users/username/Library/Caches/pypoetry/virtualenvs/poetry-test-ynfwcHPh-py3.13
```

é‡æ–°åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œçœ‹ä¸€ä¸‹å·®å¼‚ï¼š

```shell
â•­â”€ ï¼  ~/coding/poetry_test                                                                      ï€Œ   80% ï‰€  21:44 ï€— 11.11 ï³ 
â•°ï‘ ï‘ ï‘  poetry env use python3.12
Creating virtualenv poetry-test in /Users/username/coding/poetry_test/.venv
Using virtualenv: /Users/username/coding/poetry_test/.venv
```

å¯ä»¥çœ‹å‡ºï¼š

- è™šæ‹Ÿç¯å¢ƒçš„è·¯å¾„æ”¹ä¸ºé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹äº†
- åç§°å›ºå®šä½ .venv

## å¯åŠ¨ä¸é€€å‡ºè™šæ‹Ÿç¯å¢ƒ

åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ä½¿ç”¨ poetry shell å°±å¯ä»¥è¿›å…¥åˆ°è™šæ‹Ÿç¯å¢ƒ

```shell
â•­â”€ ï¼  ~/coding/poetry_test/.venv                                                                ï€Œ   80% ï‰€  21:45 ï€— 11.11 ï³ 
â•°ï‘ ï‘ ï‘  poetry shell
Spawning shell within /Users/username/coding/poetry_test/.venv

â•­â”€ ï¼  ~/coding/poetry_test/.venv                                                                       ï€Œ   21:46 ï€— 11.11 ï³ 
â•°ï‘ ï‘ ï‘  emulate bash -c '. /Users/username/coding/poetry_test/.venv/bin/activate'

â•­â”€ ï¼  ~/coding/poetry_test                                                                      ï€Œ   80% ï‰€  21:49 ï€— 11.11 ï³ 
â•°ï‘ ï‘ ï‘  python --version
Python 3.12.3
```

poetry shell æŒ‡ä»¤ä¼šæ£€æŸ¥å½“å‰ç›®å½•æˆ–ä¸Šå±‚ç›®å½•æ˜¯å¦å­˜åœ¨ pyprojectï¼Œtoml æ¥ç¡®å®šéœ€è¦å¯åŠ¨çš„è™šæ‹Ÿç¯å¢ƒï¼Œæ‰€ä»¥å¦‚æœä¸ç§»åŠ¨åˆ°é¡¹ç›®çš„ç›®å½•ä¸‹ï¼Œåˆ™ä¼šå‡ºç°é”™è¯¯ã€‚

é€€å‡ºè™šæ‹Ÿç¯å¢ƒå°±æ›´ç®€å•äº†ï¼Œåªè¦è¾“å…¥ exit å°±å¯ä»¥äº†ã€‚

```shell
â”€ ï¼  ~/coding/poetry_test                                                                      ï€Œ   79% ï‰€  21:49 ï€— 11.11 ï³ 
â•°ï‘ ï‘ ï‘  exit
â•­â”€ ï¼  ~/coding/poetry_test/.venv                                                      ï€Œ   02:59 ï‰’   79% ï‰€  21:49 ï€— 11.11 ï³ 
â•°ï‘ ï‘ ï‘  python --version
Python 3.11.5
```

## poetry æŒ‡ä»¤

poetry æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä»–æœ‰è‡ªå·±çš„æŒ‡ä»¤ï¼Œéœ€è¦èŠ±è´¹é¢å¤–çš„æ—¶é—´ä¸ç²¾åŠ›å­¦ä¹ ï¼Œç›¸è¾ƒ pip æ›´åŠ å¤æ‚ï¼Œè¿™ä¸ªèƒ½æ˜¯ä½¿ç”¨ poetry çš„ä¸€é“å…³å¡ã€‚å¥½åœ¨å¸¸ç”¨æŒ‡ä»¤å…¶å®ä¸è¶…è¿‡ 10 ä¸ªï¼Œä¸‹é¢å°±æ¥ä¸€ä¸€ä»‹ç»ã€‚

### å®‰è£…æ¨¡å—

ä½¿ç”¨æŒ‡ä»¤

```shell
poetry add
```

ç›¸è¾ƒäº pip installï¼Œæˆ‘ä»¬è¯•è¯•å®‰è£… flask çœ‹çœ‹ä¼šæœ‰ä»€ä¹ˆæ ·çš„å˜åŒ–

```shell
â”€ ï¼  ~/coding/poetry_test                                                            ï€Œ   3.15s ï‰’   79% ï‰€  21:51 ï€— 11.11 ï³ 
â•°ï‘ ï‘ ï‘  poetry add flask
Using version ^3.0.3 for flask

Updating dependencies
Resolving dependencies... (23.1s)

Package operations: 7 installs, 0 updates, 0 removals

  - Installing markupsafe (3.0.2)
  - Installing blinker (1.9.0)
  - Installing click (8.1.7): Failed

  TimeoutError

  The read operation timed out

  at ~/anaconda3/lib/python3.11/ssl.py:1167 in read
      1163â”‚         if self._sslobj is None:
      1164â”‚             raise ValueError("Read on closed or unwrapped SSL socket.")
      1165â”‚         try:
      1166â”‚             if buffer is not None:
    â†’ 1167â”‚                 return self._sslobj.read(len, buffer)
      1168â”‚             else:
      1169â”‚                 return self._sslobj.read(len)
      1170â”‚         except SSLError as x:
      1171â”‚             if x.args[0] == SSL_ERROR_EOF and self.suppress_ragged_eofs:

The following error occurred when trying to handle this error:


  ReadTimeoutError

  HTTPSConnectionPool(host='files.pythonhosted.org', port=443): Read timed out.

  at ~/anaconda3/lib/python3.11/site-packages/urllib3/response.py:753 in _error_catcher
       749â”‚ 
       750â”‚             except SocketTimeout as e:
       751â”‚                 # FIXME: Ideally we'd like to include the url in the ReadTimeoutError but
       752â”‚                 # there is yet no clean way to get at it from this context.
    â†’  753â”‚                 raise ReadTimeoutError(self._pool, None, "Read timed out.") from e  # type: ignore[arg-type]
       754â”‚ 
       755â”‚             except BaseSSLError as e:
       756â”‚                 # FIXME: Is there a better way to differentiate between SSLErrors?
       757â”‚                 if "read operation timed out" not in str(e):

The following error occurred when trying to handle this error:


  ConnectionError

  HTTPSConnectionPool(host='files.pythonhosted.org', port=443): Read timed out.

  at ~/anaconda3/lib/python3.11/site-packages/requests/models.py:826 in generate
       822â”‚                     raise ChunkedEncodingError(e)
       823â”‚                 except DecodeError as e:
       824â”‚                     raise ContentDecodingError(e)
       825â”‚                 except ReadTimeoutError as e:
    â†’  826â”‚                     raise ConnectionError(e)
       827â”‚                 except SSLError as e:
       828â”‚                     raise RequestsSSLError(e)
       829â”‚             else:
       830â”‚                 # Standard file-like object.

Cannot install click.

  - Installing itsdangerous (2.2.0)
  - Installing jinja2 (3.1.4)
  - Installing werkzeug (3.1.3)
```

å¯ä»¥çœ‹åˆ° poetry ä¼šå°†æ‰€æœ‰çš„ä¿¡æ¯å…¨éƒ¨åˆ—å‡ºæ¥ï¼Œå¹¶ä¸”æ¸…æ¥šçš„å‘ŠçŸ¥äº†æ–°å¢äº†é‚£äº›ç¬¬ä¸‰æ–¹æ¨¡å—ã€‚
(ç”±äºä½œè€…ç°åœ¨çªåœ¨åˆ—è½¦å§é“ºä¸Šç å­—ï¼Œç½‘é€Ÿç›¸å½“æ„Ÿäººï¼Œæ•…è¯·æ— è§†timeoutçš„æŠ¥é”™)
æ­¤æ—¶é¡¹ç›®ä¸­çš„ pyproject.toml ä¹Ÿå‘ç”Ÿäº†å˜åŒ–

```shell
[tool.poetry]
name = "poetry-test"
version = "0.1.0"
description = ""
authors = ["Your Name <you@example.com>"]
readme = "README.md"

[tool.poetry.dependencies]
python = "^3.11"
flask = "^3.0.3"


[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"
```

è¿™é‡Œè¦è¯´æ˜ï¼Œå®‰è£… flask ï¼Œåˆ™ pyproject.toml åªä¼šæ–°å¢ flask = "^3.0.3" è¿™ä¸ªå­—æ®µçš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œå…¶ä½™ä¾èµ–ä¸ä¼šå‡ºç°åœ¨ toml æ–‡ä»¶ä¸­ã€‚
è¿™é‡Œæ˜¯ä¸€ä¸ªéå¸¸å¤§çš„ä¼˜ç‚¹ï¼Œä»¥ä¾¿åŒºåˆ†å“ªäº›æ˜¯ç”¨æˆ·å®‰è£…çš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œå“ªäº›æ˜¯ç¬¬ä¸‰æ–¹æ¨¡å—ä¸€å¹¶å®‰è£…çš„ä¾èµ–ã€‚

### poetry.lock ä¸æ›´æ–°é¡ºåº

é™¤äº†æ›´æ–° pyproject.toml ï¼Œæ­¤æ—¶é¡¹ç›®ä¸­è¿˜ä¼šæ–°å¢ä¸€ä¸ªæ–‡ä»¶ï¼Œåä¸º poetry.lock ï¼Œå®ƒå®é™…ä¸Šå°±ç›¸å½“äº pip çš„ requirements.txt ï¼Œè¯¦ç»†è®°å½•äº†æ‰€æœ‰å®‰è£…çš„æ¨¡å—ä¸ç‰ˆæœ¬ã€‚

å½“ä½¿ç”¨ poetry add æŒ‡ä»¤æ—¶ï¼Œpoetry ä¼šè‡ªåŠ¨ä¾åºå¸®ä½ åšå®Œè¿™ä¸‰ä»¶äº‹ï¼š

æ›´æ–° pyproject.tomlã€‚
ä¾ç…§ pyproject.toml çš„å†…å®¹ï¼Œæ›´æ–° poetry.lock ã€‚
ä¾ç…§ poetry.lock çš„å†…å®¹ï¼Œæ›´æ–°è™šæ‹Ÿç¯å¢ƒã€‚
ç”±æ­¤å¯è§ï¼Œ poetry.lock çš„å†…å®¹æ˜¯å–å†³äº pyproject.toml ï¼Œä½†ä¸¤è€…å¹¶ä¸ä¼šè‡ªå·±è¿åŠ¨ï¼Œä¸€å®šè¦åŸºäºç‰¹å®šæŒ‡ä»¤æ‰ä¼šè¿›è¡ŒåŒæ­¥ä¸æ›´æ–°ï¼Œ poetry add å°±æ˜¯ä¸€ä¸ªå…¸å‹æ¡ˆä¾‹ã€‚

æ­¤æ—¶é¡¹ç›®ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```shell
poetry-demo
â”œâ”€â”€ poetry.lock
â””â”€â”€ pyproject.toml

0 directories, 2 files
```

### poetry lock ï¼šæ›´æ–° poetry.lock

å½“ä½ è‡ªè¡Œä¿®æ”¹äº† pyproject.toml å†…å®¹ï¼Œæ¯”å¦‚å˜æ›´ç‰¹å®šæ¨¡å—çš„ç‰ˆæœ¬ï¼ˆè¿™æ˜¯æœ‰å¯èƒ½çš„ï¼Œå°¤å…¶åœ¨æ‰‹åŠ¨å¤„ç†ç‰ˆæœ¬å†²çªçš„æ—¶å€™ï¼‰ï¼Œæ­¤æ—¶ poetry.lock çš„å†…å®¹ä¸ pyproject.toml å‡ºç°äº†è„±é’©ï¼Œå¿…é¡»è®©å®ƒä¾ç…§æ–°çš„ pyproject.toml å†…å®¹æ›´æ–°ã€åŒæ­¥ï¼Œä½¿ç”¨æŒ‡ä»¤ï¼š

```shell
poetry lock
```

å¦‚æ­¤ä¸€æ¥ï¼Œæ‰èƒ½ç¡®ä¿æ‰‹åŠ¨ä¿®æ”¹çš„å†…å®¹ï¼Œä¹Ÿæ›´æ–°åˆ° poetry.lock ä¸­ï¼Œæ¯•ç«Ÿè™šæ‹Ÿç¯å¢ƒå¦‚æœè¦é‡æ–°å»ºç«‹ï¼Œæ˜¯åŸºäº poetry.lock çš„å†…å®¹æ¥å®‰è£…æ¨¡å—ï¼Œè€Œé pyproject.tomlã€‚

è¿˜æ˜¯é‚£å¥è¯ï¼š
> poetry.lock ç›¸å½“äº Poetry çš„ requirements.txtã€‚

ä½†è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œ poetry lock æŒ‡ä»¤ï¼Œä»…ä¼šæ›´æ–° poetry.lock ï¼Œä¸ä¼šåŒæ—¶å®‰è£…æ¨¡å—è‡³è™šæ‹Ÿç¯å¢ƒ.
å› æ­¤ï¼Œåœ¨æ‰§è¡Œå®Œ poetry lock æŒ‡ä»¤åï¼Œå¿…é¡»å†ä½¿ç”¨ poetry install æ¥å®‰è£…æ¨¡å—ã€‚å¦åˆ™å°±ä¼šå‡ºç° poetry.lock å’Œè™šæ‹Ÿç¯å¢ƒä¸ä¸€è‡´çš„çŠ¶å†µã€‚

## æ–°å¢æ¨¡å—è‡³ dev-dependencies

æœ‰äº›æ¨¡å—ï¼Œæ¯”å¦‚ pytest ã€ black ç­‰ç­‰ï¼Œåªä¼šåœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œäº§å“çš„éƒ¨ç½²ç¯å¢ƒå¹¶ä¸éœ€è¦ã€‚

Poetry å…è®¸ä½ åŒºåˆ†è¿™ä¸¤è€…ï¼Œå°†ä¸Šè¿°çš„æ¨¡å—å®‰è£…è‡³ dev-dependencies åŒºå—ï¼Œæ–¹ä¾¿è®©ä½ è½»æ¾å»ºç«‹ä¸€ä»½ã€Œä¸åŒ…å«ã€ dev-dependencies å¼€å‘æ¨¡å—çš„å®‰è£…æ¸…å•ã€‚

åœ¨æ­¤ä»¥ Black ä¸ºä¾‹ï¼Œå®‰è£…æ–¹å¼å¦‚ä¸‹ï¼š

```shell
poetry add black --group dev
```

ç»“æœçš„åŒºåˆ«æ˜¾ç¤ºåœ¨ pyproject.toml é‡Œï¼š

```shell
[tool.poetry]
name = "poetry-test"
version = "0.1.0"
description = ""
authors = ["Your Name <you@example.com>"]
readme = "README.md"

[tool.poetry.dependencies]
python = "^3.11"
flask = "^3.0.3"


[tool.poetry.group.dev.dependencies]
black = "^24.10.0"

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"
```

å¯ä»¥çœ‹åˆ° black è¢«åˆ—åœ¨ä¸åŒåŒºå—ï¼š tool.poetry.dev-dependenciesã€‚

### Poetry æ›´æ–°æ¨¡å—

è¿™ä¸ªå°±å¾ˆç®€å•äº†ï¼Œä½¿ç”¨ poetry update æŒ‡ä»¤å³å¯ï¼š

```shell
poetry update
```

ä¸Šé¢æŒ‡ä»¤ä¼šæ›´æ–°å…¨éƒ¨å¯èƒ½å¯ä»¥æ›´æ–°çš„æ¨¡å—ï¼Œä¹Ÿå¯ä»¥ä»…æŒ‡å®šç‰¹å®šæ¨¡å—ï¼Œæ¯”å¦‚ï¼š

```shell
poetry update requests toml
```

### åˆ—å‡ºå…¨éƒ¨æ¨¡å—æ¸…å•

ç±»ä¼¼ pip list ï¼Œè¿™é‡Œè¦ä½¿ç”¨ poetry show.
è¿™é‡Œçš„æ¸…å•å†…å®¹å¹¶ä¸æ˜¯æ¥è‡ªäºè™šæ‹Ÿç¯å¢ƒï¼Œè¿™ç‚¹å’Œ pip ä¸åŒï¼Œè€Œæ˜¯æ¥è‡ªäº poetry.lock çš„å†…å®¹ã€‚
ä½ å¯èƒ½ä¼šæƒ³ï¼Œæ¥è‡ªäº poetry.lock æˆ–è™šæ‹Ÿç¯å¢ƒï¼Œæœ‰å·®å—ï¼Ÿä¸¤è€…ä¸æ˜¯åº”è¯¥è¦ä¸€è‡´ï¼Ÿ
æ²¡é”™ï¼Œç†è®ºä¸Šæ˜¯ï¼Œä½†ä¹Ÿæœ‰ä¸ä¸€è‡´çš„æ—¶å€™ï¼Œæ¯”å¦‚ä½ ä½¿ç”¨äº† pip install æŒ‡ä»¤å®‰è£…æ¨¡å—ï¼Œå°±ä¸ä¼šè®°è½½åœ¨ poetry.lock ä¸­ï¼Œé‚£ poetry show è‡ªç„¶ä¹Ÿä¸ä¼šæ˜¾ç¤ºã€‚

### æ ‘çŠ¶æ˜¾ç¤ºæ¨¡å—ä¾èµ–å±‚çº§

```shell
poetry show --tree
```

è®©ä¸»è¦æ¨¡å—ä¸å…¶ä¾èµ–æ¨¡å—çš„å…³ç³»ä¸å±‚æ¬¡ï¼Œä¸€ç›®äº†ç„¶ã€‚

è€Œä¸”å¾ˆè´´å¿ƒçš„æ˜¯ï¼Œå®ƒä¹Ÿå¯ä»¥åªæ˜¾ç¤ºæŒ‡å®šæ¨¡å—çš„ä¾èµ–å±‚çº§ï¼Œä»¥ flask ä¸ºä¾‹ï¼š

```shell
â•­â”€ ï¼  ~/coding/poetry_test                                                                     1 â†µ  77% ï‰€  22:11 ï€— 11.11 ï³ 
â•°ï‘ ï‘ ï‘  poetry show flask --tree 
flask 3.0.3 A simple framework for building complex web applications.
â”œâ”€â”€ blinker >=1.6.2
â”œâ”€â”€ click >=8.1.3
â”‚   â””â”€â”€ colorama * 
â”œâ”€â”€ itsdangerous >=2.1.2
â”œâ”€â”€ jinja2 >=3.1.2
â”‚   â””â”€â”€ markupsafe >=2.0 
â””â”€â”€ werkzeug >=3.0.0
    â””â”€â”€ markupsafe >=2.1.1 
```

### Poetry ç§»é™¤æ¨¡å—

ä½¿ç”¨ poetry remove æŒ‡ä»¤ã€‚å’Œ poetry add ä¸€æ ·ï¼Œå¯ä»¥åŠ ä¸Š -D å‚æ•°æ¥ç§»é™¤ç½®äºå¼€å‘åŒºçš„æ¨¡å—ã€‚

è€Œç§»é™¤æ¨¡å—æ—¶çš„ä¾èµ–è§£æèƒ½åŠ›ï¼Œæ­£æ˜¯ Poetry è¿œä¼˜äº pip çš„ä¸»è¦ç¯èŠ‚ï¼Œå› ä¸º pip æ²¡æœ‰å˜›ï¼ä¹Ÿæ˜¯æˆ‘æè®®æ”¹ç”¨ Poetry çš„å…³é”®ç†ç”±â€”â€”ä¸ºäº†é¡ºåˆ©ç§»é™¤æ¨¡å—ä¸ä¾èµ–ã€‚

å‰é¢å·²ç»æè¿‡ï¼Œpip çš„ pip uninstall åªä¼šç§»é™¤ä½ æ‰€æŒ‡å®šçš„æ¨¡å—ï¼Œè€Œä¸ä¼šè¿åŒä¾èµ–æ¨¡å—ä¸€èµ·ç§»é™¤ã€‚

è¿™æ˜¯åŸºäºå®‰å…¨è€ƒé‡ï¼Œå› ä¸º pip æ²¡æœ‰ä¾èµ–è§£æåŠŸèƒ½ã€‚å¦‚æœè´¸ç„¶ç§»é™¤æ‰€æœ‰å®‰è£…æ—¶ä¸€å¹¶å®‰è£…çš„ä¾èµ–æ¨¡å—ï¼Œå¯èƒ½ä¼šé€ æˆå·¨å¤§ç¾éš¾ï¼Œè®©åˆ«çš„æ¨¡å—å¤±å»æ•ˆç”¨ã€‚

æ‰€ä»¥ï¼Œä½¿ç”¨ pip æ—¶ï¼Œæˆ‘ä»¬é²œå°‘ä¼šå»ç§»é™¤å·²ç»ä¸å†ä½¿ç”¨çš„æ¨¡å—ã€‚æ¯•ç«Ÿä¾èµ–å…³ç³»é”™ç»¼å¤æ‚ï¼Œç§»é™¤æ¨¡å—å¯èƒ½é€ æˆè®¸å¤šå‰¯ä½œç”¨ï¼Œå®åœ¨æ˜¯å¤ªéº»çƒ¦äº†ã€‚

```shell
poetry remove flask
```

### è¾“å‡º Poetry è™šæ‹Ÿç¯å¢ƒçš„ requirements.txt

ç†è®ºä¸Šï¼Œå…¨é¢æ”¹ç”¨ Poetry åï¼Œé¡¹ç›®ä¸­æ˜¯ä¸éœ€è¦å­˜åœ¨ requirements.txt ï¼Œå› ä¸ºå®ƒçš„è§’è‰²å·²ç»å®Œå…¨è¢« poetry.lock æ‰€å–ä»£ã€‚

ä½†äº‹å®æ˜¯ï¼Œä½ å¯èƒ½è¿˜æ˜¯éœ€è¦å®ƒï¼Œç”šè‡³å¸Œæœ›å®ƒéšç€ poetry.lock çš„å†…å®¹æ›´æ–°ã€‚

åœ¨ Poetry çš„è™šæ‹Ÿç¯å¢ƒä¸‹ï¼Œä½¿ç”¨ä»¥å¾€ç†Ÿæ‚‰çš„æŒ‡ä»¤ pip freeze > requirements.txt å°±å¯ä»¥äº†ã€‚

```shell
pip freeze > requirements.txt
```

æˆ–è€…
```shell
poetry export -f requirements.txt -o requirements.txt --without-hashes
```

å¦‚æœè¦è¾“å‡ºè¾“å‡º [tool.poetry.dev-dependencies] çš„æ¨¡å—ï¼Œå¯ä»¥æ·»åŠ --devå‚æ•°

```shell
poetry export -f requirements.txt -o requirements.txt --without-hashes --dev
```

### Poetry å¸¸ç”¨æŒ‡ä»¤æ¸…å•

Poetry çš„å¸¸ç”¨æŒ‡ä»¤ä¸»è¦æœ‰ä¸‹é¢å‡ ä¸ªï¼š
- poetry add
- poetry remove
- poetry export
- poetry env use
- poetry shell
- poetry show
- poetry init
- poetry install

### ä¿®æ”¹ poetry é•œåƒæº

ä¿®æ”¹ä¸ºæ¸…åé•œåƒæº

```shell
poetry source add tsinghua https://pypi.tuna.tsinghua.edu.cn/simple
```
æˆ–è€…åœ¨pyproject.tomlæ–‡ä»¶æœ€åæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š

```shell
[[tool.poetry.source]]
name = "tsinghua"
default = true
url = "https://pypi.tuna.tsinghua.edu.cn/simple"
```

---
*å¦‚æœä½ è§‰å¾—æˆ‘çš„å†…å®¹ä¸é”™ï¼Œè€ƒè™‘è¯·æˆ‘å–æ¯å’–å•¡å—ï¼Ÿ*
*if you like what i do, maybe consider buying me a coffee/tea* ğŸ¥ºğŸ‘‰ğŸ‘ˆ

<p className="py-2 text-center mx-auto prose-p">
    <a href="https://buymeacoffee.com/johncachy" target="_blank" className="block text-center">
        <img src="https://cdn.buymeacoffee.com/buttons/v2/default-red.png" alt="Buy Me A Coffee" width="150"  className="mx-auto" style={{ marginTop: '20px' }} />
    </a>
</p>